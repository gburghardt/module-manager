/*! module-manager 2014-05-16 */
;this.Module=this.Module||{};(function(){function Factory(){}Factory.prototype={objectFactory:null,constructor:Factory,destructor:function(){this.objectFactory=null},getInstance:function(type){var instance=null,Klass=null;if(this.objectFactory){instance=this.objectFactory.getInstance(type)}if(!instance){if(/^[a-zA-Z][a-zA-Z0-9.]+[a-zA-Z0-9]$/.test(type)){try{Klass=eval(type)}catch(error){throw new Error("Class name "+type+" does not exist")}if(!Klass){throw new Error("Class name "+type+" does not exist")}else{if(typeof Klass!=="function"){throw new Error("Class name "+type+" is not a constructor function")}}instance=new Klass()}else{throw new Error("Cannot instantiate invalid type: "+type)}}return instance}};Module.Factory=Factory})();(function(){function a(){}a.prototype={baseClassName:"module",defaultModule:null,defaultModuleFocused:false,moduleObserver:{onModuleCreated:function(c,b,d){},onSubModuleCreated:function(c,b,d){},onModuleRegistered:function(b,c){},onModuleUnregistered:function(b){}},provider:null,registry:null,groups:null,constructor:Module.Manager,destructor:function(b){if(Module.manager===this){Module.manager=null}if(this.registry){this._destroyRegistry(b)}if(this.groups){this._destroyGroups()}if(this.provider){if(b){this.provider.destructor()}this.provider=null}if(this.lazyLoader){this.lazyLoader.destructor();this.lazyLoader=null}},_destroyGroups:function(){var c,e,b,d;for(c in this.groups){if(this.groups.hasOwnProperty(c)){e=this.groups[c];for(b=0,d=e.length;b<d;b++){e[b]=null}this.groups[c]=null}}this.groups=null},_destroyRegistry:function(d){var b,c;for(b in this.registry){if(this.registry.hasOwnProperty(b)){c=this.registry[b];this.moduleObserver.onModuleUnregistered(c.module);if(d){c.module.destructor(true)}c.module=null;this.registry[b]=null}}this.registry=null},init:function(){this.provider=this.provider||new Module.Provider();this.provider.factory=this.provider.factory||new Module.Factory();this.provider.manager=this;this.provider.moduleObserver=this.moduleObserver;this.registry=this.registry||{};this.groups=this.groups||{};Module.manager=this;return this},eagerLoadModules:function(d){var c=d.querySelectorAll("[data-modules]"),b=0;for(b;b<c.length;b++){this.createModules(c[b])}c=null;return this},lazyLoadModules:function(c,b){this.lazyLoader=(this.lazyLoader||new Module.LazyLoader()).setManager(this).setElement(c).setOptions(b).init();c=b=null;return this},createModule:function(d,f,b,e){var c=this.provider.createModule(d,f,b);if(e){this.registerModule(f,c)}d=b=null;return c},createModules:function(d,e){if(!d){throw new Error("Missing required argument: element")}else{if(!e&&d.getAttribute("data-module-lazyload")){return[]}else{if(d.getAttribute("data-module-property")){return[]}}}var b=new Module.MetaData(d),c=[];if(b.mediaMatches()){this.provider.createModules(b,function(h,g,i,f){c.push(h);this.registerModule(i,h);h.init()},this);this.markModulesCreated(d,b)}b=d=null;return c},focusDefaultModule:function(b){if(this.defaultModule&&!this.defaultModuleFocused){this.defaultModuleFocused=true;this.defaultModule.focus(b)}},initModuleInContainer:function(e,b,d,k,h,c){var g=new Date();var j={guid:c.guid,createdAt:g,timestamp:g.getTime(),controllerId:c.controllerId},i;if(d.renderData){for(i in d.renderData){if(d.renderData.hasOwnProperty(i)){j[i]=d.renderData[i]}}}var f=k.innerHTML.replace(/#\{([-.\w]+)\}/g,function(l,m){return j[m]||""});e.className+=(" "+this.baseClassName+" "+d.className).replace(/\s{2,}/g," ");e.innerHTML=f;if(d.insert==="top"&&b.firstChild){b.insertBefore(e,b.firstChild)}else{b.appendChild(e)}this.registerModule(h,c);c.init();if(d.autoFocus){c.focus(!!d.autoFocusAnything)}},markModulesCreated:function(c,b){c.setAttribute("data-modules-created",b.types.join(" "));c.removeAttribute("data-modules");c=b=null},registerModule:function(c,b){if(b.guid===undefined||b.guid===null){throw new Error("Cannot register module "+c+" without a guid property")}else{if(this.registry[b.guid]){throw new Error("Module "+b.guid+" has already been registered")}}this.registry[b.guid]={module:b,type:c};if(!this.groups[c]){this.groups[c]=[]}this.groups[c].push(b);this.moduleObserver.onModuleRegistered(b,c);b=null},unregisterModule:function(e){if(!e.guid||!this.registry[e.guid]){e=null;return false}var c=e.guid,f=this.registry[c].type,h=this.groups[f],b=false;this.registry[c].module=null;this.registry[c]=null;delete this.registry[c];if(h){for(var d=0,g=h.length;d<g;d++){if(h[d]===e){h.splice(d,1);b=true;this.moduleObserver.onModuleUnregistered(e);break}}}e=h=null;return b},setDefaultModule:function(b){if(!this.defaultModule){this.defaultModule=b}b=null}};Module.Manager=a})();(function(b){function a(c){this.options=null;this.types=[];if(c){this.setElement(c)}}a.prototype={element:null,media:null,options:null,types:null,constructor:a,forEach:function(j,f){var e=0,h=this.types.length,c,g,d;if(h===1){j.call(f,this.element,this.types[0],this.options,0,this)}else{for(e;e<h;++e){g=this.types[e];d=this.options[g]||{};c=j.call(f,this.element,g,d,e,this);if(c===false){break}}}},mediaMatches:function(){if(!b.matchMedia){throw new Error("This browser does not support JavaScript media queries. Please include a polyfill (https://github.com/paulirish/matchMedia.js)")}return this.media===null||b.matchMedia(this.media).matches},setElement:function(e){this.element=e;var d=e.getAttribute("data-modules"),c=e.getAttribute("data-module-options");if(!d){throw new Error("Missing required attribute data-modules on "+e.nodeName+"."+e.className.split(/\s+/g).join(".")+"#"+e.id)}this.types=d.replace(/^\s+|\s+$/g,"").split(/\s+/g);this.options=c?JSON.parse(c):{};this.media=e.getAttribute("data-module-media")}};b.Module.MetaData=a})(this);(function(){function a(){}a.prototype={factory:null,manager:null,moduleObserver:null,subModulesEnabled:true,constructor:a,destructor:function(b){if(b&&this.factory){this.factory.destructor()}this.factory=this.manager=null},_createModuleClass:function(b){return"module "+b.charAt(0).toLowerCase()+b.slice(1,b.length).replace(/(\.[A-Z])/g,function(d,c){return"-"+c.replace(/\./g,"").toLowerCase()}).replace(/Module$/,"").replace(/^\s+|\s+$/g,"")},createModule:function(d,f,b){var c=this.factory.getInstance(f);var e=this._createModuleClass(f);d.className+=d.className?" "+e:e;c.setElement(d);c.setOptions(b);if(b.defaultModule){this.manager.setDefaultModule(c)}this.moduleObserver.onModuleCreated(c,d,f);if(this.subModulesEnabled&&!b.subModulesDisabled){this._createSubModules(c)}return c},createModules:function(b,f,e){var c=[],d,f=f||function(){};b.forEach(function(h,i,g){d=this.createModule(h,i,g);c.push(d);f.call(e,d,h,i,g)},this);f=e=d=null;return c},_createSubModules:function(f){var e=f.element.getElementsByTagName("*"),g=e.length,d=0,c,b;for(d;d<g;d++){c=e[d];b=c.getAttribute("data-module-property");if(b){this._createSubModuleProperty(f,b,c)}}},_createSubModuleProperty:function(f,d,e){var b=new Module.MetaData(e),c;if(b.types.length>1){throw new Error("Sub module elements cannot have more than one type specified in data-modules")}c=this.createModule(e,b.types[0],b.options);this.moduleObserver.onSubModuleCreated(c,e,b.types[0]);c.init();if(f[d]===null){f[d]=c}else{if(f[d] instanceof Array){if(!f.hasOwnProperty(d)){f[d]=[]}f[d].push(c)}else{throw new Error("Cannot create sub module property '"+d+"'. Property is neither null nor an Array on the parent module.")}}this.manager.markModulesCreated(e,b);c=b=e=null}};Module.Provider=a})();